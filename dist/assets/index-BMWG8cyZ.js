var xe=Object.defineProperty;var ie=s=>{throw TypeError(s)};var ze=(s,t,e)=>t in s?xe(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var u=(s,t,e)=>ze(s,typeof t!="symbol"?t+"":t,e),U=(s,t,e)=>t.has(s)||ie("Cannot "+e);var r=(s,t,e)=>(U(s,t,"read from private field"),e?e.call(s):t.get(s)),v=(s,t,e)=>t.has(s)?ie("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),b=(s,t,e,i)=>(U(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e),h=(s,t,e)=>(U(s,t,"access private method"),e);import*as be from"https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";import{RoomEnvironment as Ae}from"https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/environments/RoomEnvironment.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();const{Clock:Pe,PerspectiveCamera:Me,Scene:Se,WebGLRenderer:Ce,SRGBColorSpace:Re,MathUtils:q,Vector2:K,Vector3:w,MeshPhysicalMaterial:Le,ShaderChunk:De,Color:se,Object3D:Ee,InstancedMesh:Fe,PMREMGenerator:Oe,SphereGeometry:ke,AmbientLight:Be,PointLight:Ve,ACESFilmicToneMapping:Ie,Raycaster:Ne,Plane:_e}=be;var g,C,F,R,O,k,B,V,M,I,o,ae,ce,he,le,me,fe,$,T,de,J,pe,Q,W,ue;class He{constructor(t){v(this,o);v(this,g);u(this,"canvas");u(this,"camera");u(this,"cameraMinAspect");u(this,"cameraMaxAspect");u(this,"cameraFov");u(this,"maxPixelRatio");u(this,"minPixelRatio");u(this,"scene");u(this,"renderer");v(this,C);u(this,"size",{width:0,height:0,wWidth:0,wHeight:0,ratio:0,pixelRatio:0});u(this,"render",h(this,o,ue));u(this,"onBeforeRender",()=>{});u(this,"onAfterRender",()=>{});u(this,"onAfterResize",()=>{});v(this,F,!1);v(this,R,!1);u(this,"isDisposed",!1);v(this,O);v(this,k);v(this,B);v(this,V,new Pe);v(this,M,{elapsed:0,delta:0});v(this,I);b(this,g,{...t}),h(this,o,ae).call(this),h(this,o,ce).call(this),h(this,o,he).call(this),this.resize(),h(this,o,le).call(this)}resize(){let t,e;r(this,g).size instanceof Object?(t=r(this,g).size.width,e=r(this,g).size.height):r(this,g).size==="parent"&&this.canvas.parentNode?(t=this.canvas.parentNode.offsetWidth,e=this.canvas.parentNode.offsetHeight):(t=window.innerWidth,e=window.innerHeight),this.size.width=t,this.size.height=e,this.size.ratio=t/e,h(this,o,de).call(this),h(this,o,pe).call(this),this.onAfterResize(this.size)}updateWorldSize(){if(this.camera.isPerspectiveCamera){const t=this.camera.fov*Math.PI/180;this.size.wHeight=2*Math.tan(t/2)*this.camera.position.length(),this.size.wWidth=this.size.wHeight*this.camera.aspect}else this.camera.isOrthographicCamera&&(this.size.wHeight=this.camera.top-this.camera.bottom,this.size.wWidth=this.camera.right-this.camera.left)}get postprocessing(){return r(this,C)}set postprocessing(t){b(this,C,t),this.render=t.render.bind(t)}clear(){this.scene.traverse(t=>{t.isMesh&&typeof t.material=="object"&&t.material!==null&&(Object.keys(t.material).forEach(e=>{const i=t.material[e];i!==null&&typeof i=="object"&&typeof i.dispose=="function"&&i.dispose()}),t.material.dispose(),t.geometry.dispose())}),this.scene.clear()}dispose(){var t;h(this,o,me).call(this),h(this,o,W).call(this),this.clear(),(t=r(this,C))==null||t.dispose(),this.renderer.dispose(),this.isDisposed=!0}}g=new WeakMap,C=new WeakMap,F=new WeakMap,R=new WeakMap,O=new WeakMap,k=new WeakMap,B=new WeakMap,V=new WeakMap,M=new WeakMap,I=new WeakMap,o=new WeakSet,ae=function(){this.camera=new Me,this.cameraFov=this.camera.fov},ce=function(){this.scene=new Se},he=function(){r(this,g).canvas?this.canvas=r(this,g).canvas:r(this,g).id?this.canvas=document.getElementById(r(this,g).id):console.error("Three: Missing canvas or id parameter"),this.canvas.style.display="block";const t={canvas:this.canvas,powerPreference:"high-performance",...r(this,g).rendererOptions??{}};this.renderer=new Ce(t),this.renderer.outputColorSpace=Re},le=function(){r(this,g).size instanceof Object||(window.addEventListener("resize",h(this,o,T).bind(this)),r(this,g).size==="parent"&&this.canvas.parentNode&&(b(this,k,new ResizeObserver(h(this,o,T).bind(this))),r(this,k).observe(this.canvas.parentNode))),b(this,O,new IntersectionObserver(h(this,o,fe).bind(this),{root:null,rootMargin:"0px",threshold:0})),r(this,O).observe(this.canvas),document.addEventListener("visibilitychange",h(this,o,$).bind(this))},me=function(){var t,e;window.removeEventListener("resize",h(this,o,T).bind(this)),(t=r(this,k))==null||t.disconnect(),(e=r(this,O))==null||e.disconnect(),document.removeEventListener("visibilitychange",h(this,o,$).bind(this))},fe=function(t){b(this,F,t[0].isIntersecting),r(this,F)?h(this,o,Q).call(this):h(this,o,W).call(this)},$=function(){r(this,F)&&(document.hidden?h(this,o,W).call(this):h(this,o,Q).call(this))},T=function(){r(this,B)&&clearTimeout(r(this,B)),b(this,B,setTimeout(this.resize.bind(this),100))},de=function(){this.camera.aspect=this.size.width/this.size.height,this.camera.isPerspectiveCamera&&this.cameraFov&&(this.cameraMinAspect&&this.camera.aspect<this.cameraMinAspect?h(this,o,J).call(this,this.cameraMinAspect):this.cameraMaxAspect&&this.camera.aspect>this.cameraMaxAspect?h(this,o,J).call(this,this.cameraMaxAspect):this.camera.fov=this.cameraFov),this.camera.updateProjectionMatrix(),this.updateWorldSize()},J=function(t){const e=Math.tan(q.degToRad(this.cameraFov/2))/(this.camera.aspect/t);this.camera.fov=2*q.radToDeg(Math.atan(e))},pe=function(){var e;this.renderer.setSize(this.size.width,this.size.height),(e=r(this,C))==null||e.setSize(this.size.width,this.size.height);let t=window.devicePixelRatio;this.maxPixelRatio&&t>this.maxPixelRatio?t=this.maxPixelRatio:this.minPixelRatio&&t<this.minPixelRatio&&(t=this.minPixelRatio),this.renderer.setPixelRatio(t),this.size.pixelRatio=t},Q=function(){if(r(this,R))return;const t=()=>{b(this,I,requestAnimationFrame(t)),r(this,M).delta=r(this,V).getDelta(),r(this,M).elapsed+=r(this,M).delta,this.onBeforeRender(r(this,M)),this.render(),this.onAfterRender(r(this,M))};b(this,R,!0),r(this,V).start(),t()},W=function(){r(this,R)&&(cancelAnimationFrame(r(this,I)),b(this,R,!1),r(this,V).stop())},ue=function(){this.renderer.render(this.scene,this.camera)};const S=new Map,L=new K;let j=!1;function Te(s){const t={position:new K,nPosition:new K,hover:!1,onEnter(){},onMove(){},onClick(){},onLeave(){},...s};return function(i,n){S.has(i)||(S.set(i,n),j||(document.body.addEventListener("pointermove",ne),document.body.addEventListener("pointerleave",oe),document.body.addEventListener("click",We),j=!0))}(s.domElement,t),t.dispose=()=>{const e=s.domElement;S.delete(e),S.size===0&&(document.body.removeEventListener("pointermove",ne),document.body.removeEventListener("pointerleave",oe),j=!1)},t}function ne(s){L.x=s.clientX,L.y=s.clientY;for(const[t,e]of S){const i=t.getBoundingClientRect();ye(i)?(ge(e,i),e.hover||(e.hover=!0,e.onEnter(e)),e.onMove(e)):e.hover&&(e.hover=!1,e.onLeave(e))}}function We(s){L.x=s.clientX,L.y=s.clientY;for(const[t,e]of S){const i=t.getBoundingClientRect();ge(e,i),ye(i)&&e.onClick(e)}}function oe(){for(const s of S.values())s.hover&&(s.hover=!1,s.onLeave(s))}function ge(s,t){const{position:e,nPosition:i}=s;e.x=L.x-t.left,e.y=L.y-t.top,i.x=e.x/t.width*2-1,i.y=-e.y/t.height*2+1}function ye(s){const{x:t,y:e}=L,{left:i,top:n,width:a,height:l}=s;return t>=i&&t<=i+a&&e>=n&&e<=n+l}const{randFloat:Ye,randFloatSpread:G}=q,Z=new w,f=new w,m=new w,N=new w,_=new w,D=new w,P=new w,H=new w,re=new w;var Y,ve;class Xe{constructor(t){v(this,Y);this.config=t,this.positionData=new Float32Array(3*t.count).fill(0),this.velocityData=new Float32Array(3*t.count).fill(0),this.sizeData=new Float32Array(t.count).fill(1),this.center=new w,h(this,Y,ve).call(this),this.setSizes()}setSizes(){const{config:t,sizeData:e}=this;e[0]=t.size0;for(let i=1;i<t.count;i++)e[i]=Ye(t.minSize,t.maxSize)}update(t){const{config:e,center:i,positionData:n,sizeData:a,velocityData:l}=this;let y=0;e.controlSphere0&&(y=1,Z.fromArray(n,0),Z.lerp(i,.1).toArray(n,0),m.set(0,0,0).toArray(l,0));for(let d=y;d<e.count;d++){const p=3*d;f.fromArray(n,p),m.fromArray(l,p),m.y-=t.delta*e.gravity*a[d],m.multiplyScalar(e.friction),m.clampLength(0,e.maxVelocity),f.add(m),f.toArray(n,p),m.toArray(l,p)}for(let d=y;d<e.count;d++){const p=3*d;f.fromArray(n,p),m.fromArray(l,p);const c=a[d];for(let x=d+1;x<e.count;x++){const z=3*x;N.fromArray(n,z),_.fromArray(l,z);const X=a[x];D.copy(N).sub(f);const ee=D.length(),te=c+X;if(ee<te){const we=te-ee;P.copy(D).normalize().multiplyScalar(.5*we),H.copy(P).multiplyScalar(Math.max(m.length(),1)),re.copy(P).multiplyScalar(Math.max(_.length(),1)),f.sub(P),m.sub(H),f.toArray(n,p),m.toArray(l,p),N.add(P),_.add(re),N.toArray(n,z),_.toArray(l,z)}}if(e.controlSphere0){D.copy(Z).sub(f);const x=D.length(),z=c+a[0];if(x<z){const X=z-x;P.copy(D.normalize()).multiplyScalar(X),H.copy(P).multiplyScalar(Math.max(m.length(),2)),f.sub(P),m.sub(H)}}Math.abs(f.x)+c>e.maxX&&(f.x=Math.sign(f.x)*(e.maxX-c),m.x=-m.x*e.wallBounce),e.gravity===0?Math.abs(f.y)+c>e.maxY&&(f.y=Math.sign(f.y)*(e.maxY-c),m.y=-m.y*e.wallBounce):f.y-c<-e.maxY&&(f.y=-e.maxY+c,m.y=-m.y*e.wallBounce);const A=Math.max(e.maxZ,e.maxSize);Math.abs(f.z)+c>A&&(f.z=Math.sign(f.z)*(e.maxZ-c),m.z=-m.z*e.wallBounce),f.toArray(n,p),m.toArray(l,p)}}}Y=new WeakSet,ve=function(){const{config:t,positionData:e}=this;this.center.toArray(e,0);for(let i=1;i<t.count;i++){const n=3*i;e[n]=G(2*t.maxX),e[n+1]=G(2*t.maxY),e[n+2]=G(2*t.maxZ)}};class Ue extends Le{constructor(t){super(t),this.uniforms={thicknessDistortion:{value:.1},thicknessAmbient:{value:0},thicknessAttenuation:{value:.1},thicknessPower:{value:2},thicknessScale:{value:10}},this.defines.USE_UV="",this.onBeforeCompile=e=>{Object.assign(e.uniforms,this.uniforms),e.fragmentShader=`
        uniform float thicknessPower;
        uniform float thicknessScale;
        uniform float thicknessDistortion;
        uniform float thicknessAmbient;
        uniform float thicknessAttenuation;
        ${e.fragmentShader}
      `,e.fragmentShader=e.fragmentShader.replace("void main() {",`
        void RE_Direct_Scattering(const in IncidentLight directLight, const in vec2 uv, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, inout ReflectedLight reflectedLight) {
          vec3 scatteringHalf = normalize(directLight.direction + (geometryNormal * thicknessDistortion));
          float scatteringDot = pow(saturate(dot(geometryViewDir, -scatteringHalf)), thicknessPower) * thicknessScale;
          #ifdef USE_COLOR
            vec3 scatteringIllu = (scatteringDot + thicknessAmbient) * vColor;
          #else
            vec3 scatteringIllu = (scatteringDot + thicknessAmbient) * diffuse;
          #endif
          reflectedLight.directDiffuse += scatteringIllu * thicknessAttenuation * directLight.color;
        }

        void main() {
        `);const i=De.lights_fragment_begin.replaceAll("RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );",`
          RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
          RE_Direct_Scattering(directLight, vUv, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, reflectedLight);
        `);e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",i),this.onBeforeCompile2&&this.onBeforeCompile2(e)}}}const je={count:200,colors:[128,0,16777215],ambientColor:16777215,ambientIntensity:.5,lightIntensity:300,materialParams:{metalness:.3,roughness:.4,clearcoat:.8,clearcoatRoughness:.2},minSize:.4,maxSize:.8,size0:1,gravity:1,friction:.99,wallBounce:.95,maxVelocity:.2,maxX:5,maxY:5,maxZ:2,controlSphere0:!1,followCursor:!1},E=new Ee;class Ge extends Fe{constructor(t,e={}){const i={...je,...e},n=new Ae,a=new Oe(t,.04).fromScene(n).texture,l=new ke,y=new Ue({envMap:a,...i.materialParams});super(l,y,i.count),this.config=i,this.ambientLight=new Be(this.config.ambientColor,this.config.ambientIntensity),this.add(this.ambientLight),this.light=new Ve(this.config.colors[0],this.config.lightIntensity),this.light.position.set(0,0,0),this.add(this.light),this.physics=new Xe(i),this.physics&&this.physics.positionData&&this.physics.positionData.length>=3&&this.light.position.fromArray(this.physics.positionData,0),this.setColors(i.colors)}setColors(t){if(Array.isArray(t)&&t.length>1){const e=function(i){let n,a;function l(y){n=y,a=[],n.forEach(d=>{a.push(new se(d))})}return l(i),{setColors:l,getColorAt:function(y,d=new se){const p=Math.max(0,Math.min(1,y))*(n.length-1),c=Math.floor(p),A=a[c];if(c>=n.length-1)return A.clone();const x=p-c,z=a[c+1];return d.r=A.r+x*(z.r-A.r),d.g=A.g+x*(z.g-A.g),d.b=A.b+x*(z.b-A.b),d}}}(t);for(let i=0;i<this.count;i++)this.setColorAt(i,e.getColorAt(i/this.count)),i===0&&this.light.color.copy(e.getColorAt(i/this.count));this.instanceColor.needsUpdate=!0}}update(t){if(this.physics){this.physics.update(t);for(let e=0;e<this.count;e++)E.position.fromArray(this.physics.positionData,3*e),e===0&&this.config.followCursor===!1?E.scale.setScalar(0):E.scale.setScalar(this.physics.sizeData[e]),E.updateMatrix(),this.setMatrixAt(e,E.matrix),e===0&&this.light&&this.light.position.copy(E.position);this.instanceMatrix.needsUpdate=!0}}}function Ze(s,t={}){const e=new He({canvas:s,size:"parent",rendererOptions:{antialias:!0,alpha:!0}});let i;e.renderer.toneMapping=Ie,e.camera.position.set(0,0,20),e.camera.lookAt(0,0,0),e.cameraMaxAspect=1.5,e.resize(),p(t);const n=new Ne,a=new _e(new w(0,0,1),0),l=new w;let y=!1;const d=Te({domElement:s,onMove(){n.setFromCamera(d.nPosition,e.camera),e.camera.getWorldDirection(a.normal),n.ray.intersectPlane(a,l),i.physics.center.copy(l),i.config.controlSphere0=!0},onLeave(){i.config.controlSphere0=!1}});function p(c){i&&(e.clear(),e.scene.remove(i)),i=new Ge(e.renderer,c),e.scene.add(i)}return e.onBeforeRender=c=>{y||i.update(c)},e.onAfterResize=c=>{i.config.maxX=c.wWidth/2,i.config.maxY=c.wHeight/2},{three:e,get spheres(){return i},setCount(c){p({...i.config,count:c})},togglePause(){y=!y},dispose(){d.dispose(),e.dispose()}}}class qe{constructor(t,e={}){this.instance=Ze(t,e)}setCount(t){this.instance.setCount(t)}togglePause(){this.instance.togglePause()}dispose(){this.instance.dispose()}}document.addEventListener("DOMContentLoaded",()=>{const s=document.getElementById("ballpit-canvas");if(!s)return;const t=new qe(s,{count:200,colors:[16711680,65280,255,16776960,16711935,65535],gravity:.7,friction:.8,wallBounce:.95,followCursor:!0});window.addEventListener("resize",()=>{t&&t.instance&&t.instance.three&&t.instance.three.resize()})});
