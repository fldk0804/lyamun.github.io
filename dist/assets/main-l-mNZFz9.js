var xe=Object.defineProperty;var ie=s=>{throw TypeError(s)};var ze=(s,t,e)=>t in s?xe(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var g=(s,t,e)=>ze(s,typeof t!="symbol"?t+"":t,e),U=(s,t,e)=>t.has(s)||ie("Cannot "+e);var o=(s,t,e)=>(U(s,t,"read from private field"),e?e.call(s):t.get(s)),v=(s,t,e)=>t.has(s)?ie("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),b=(s,t,e,i)=>(U(s,t,"write to private field"),i?i.call(s,e):t.set(s,e),e),c=(s,t,e)=>(U(s,t,"access private method"),e);import"./index-CNxlMlQw.js";import*as be from"https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";import{RoomEnvironment as Ae}from"https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/environments/RoomEnvironment.js";const{Clock:Me,PerspectiveCamera:Pe,Scene:Se,WebGLRenderer:Ce,SRGBColorSpace:Re,MathUtils:q,Vector2:$,Vector3:w,MeshPhysicalMaterial:Le,ShaderChunk:De,Color:se,Object3D:Ee,InstancedMesh:Fe,PMREMGenerator:ke,SphereGeometry:Be,AmbientLight:Ve,PointLight:Oe,ACESFilmicToneMapping:Ie,Raycaster:Ne,Plane:_e}=be;var u,C,F,R,k,B,V,O,P,I,n,ae,ce,he,le,me,de,J,T,fe,K,pe,Q,W,ge;class He{constructor(t){v(this,n);v(this,u);g(this,"canvas");g(this,"camera");g(this,"cameraMinAspect");g(this,"cameraMaxAspect");g(this,"cameraFov");g(this,"maxPixelRatio");g(this,"minPixelRatio");g(this,"scene");g(this,"renderer");v(this,C);g(this,"size",{width:0,height:0,wWidth:0,wHeight:0,ratio:0,pixelRatio:0});g(this,"render",c(this,n,ge));g(this,"onBeforeRender",()=>{});g(this,"onAfterRender",()=>{});g(this,"onAfterResize",()=>{});v(this,F,!1);v(this,R,!1);g(this,"isDisposed",!1);v(this,k);v(this,B);v(this,V);v(this,O,new Me);v(this,P,{elapsed:0,delta:0});v(this,I);b(this,u,{...t}),c(this,n,ae).call(this),c(this,n,ce).call(this),c(this,n,he).call(this),this.resize(),c(this,n,le).call(this)}resize(){let t,e;o(this,u).size instanceof Object?(t=o(this,u).size.width,e=o(this,u).size.height):o(this,u).size==="parent"&&this.canvas.parentNode?(t=this.canvas.parentNode.offsetWidth,e=this.canvas.parentNode.offsetHeight):(t=window.innerWidth,e=window.innerHeight),this.size.width=t,this.size.height=e,this.size.ratio=t/e,c(this,n,fe).call(this),c(this,n,pe).call(this),this.onAfterResize(this.size)}updateWorldSize(){if(this.camera.isPerspectiveCamera){const t=this.camera.fov*Math.PI/180;this.size.wHeight=2*Math.tan(t/2)*this.camera.position.length(),this.size.wWidth=this.size.wHeight*this.camera.aspect}else this.camera.isOrthographicCamera&&(this.size.wHeight=this.camera.top-this.camera.bottom,this.size.wWidth=this.camera.right-this.camera.left)}get postprocessing(){return o(this,C)}set postprocessing(t){b(this,C,t),this.render=t.render.bind(t)}clear(){this.scene.traverse(t=>{t.isMesh&&typeof t.material=="object"&&t.material!==null&&(Object.keys(t.material).forEach(e=>{const i=t.material[e];i!==null&&typeof i=="object"&&typeof i.dispose=="function"&&i.dispose()}),t.material.dispose(),t.geometry.dispose())}),this.scene.clear()}dispose(){var t;c(this,n,me).call(this),c(this,n,W).call(this),this.clear(),(t=o(this,C))==null||t.dispose(),this.renderer.dispose(),this.isDisposed=!0}}u=new WeakMap,C=new WeakMap,F=new WeakMap,R=new WeakMap,k=new WeakMap,B=new WeakMap,V=new WeakMap,O=new WeakMap,P=new WeakMap,I=new WeakMap,n=new WeakSet,ae=function(){this.camera=new Pe,this.cameraFov=this.camera.fov},ce=function(){this.scene=new Se},he=function(){o(this,u).canvas?this.canvas=o(this,u).canvas:o(this,u).id?this.canvas=document.getElementById(o(this,u).id):console.error("Three: Missing canvas or id parameter"),this.canvas.style.display="block";const t={canvas:this.canvas,powerPreference:"high-performance",...o(this,u).rendererOptions??{}};this.renderer=new Ce(t),this.renderer.outputColorSpace=Re},le=function(){o(this,u).size instanceof Object||(window.addEventListener("resize",c(this,n,T).bind(this)),o(this,u).size==="parent"&&this.canvas.parentNode&&(b(this,B,new ResizeObserver(c(this,n,T).bind(this))),o(this,B).observe(this.canvas.parentNode))),b(this,k,new IntersectionObserver(c(this,n,de).bind(this),{root:null,rootMargin:"0px",threshold:0})),o(this,k).observe(this.canvas),document.addEventListener("visibilitychange",c(this,n,J).bind(this))},me=function(){var t,e;window.removeEventListener("resize",c(this,n,T).bind(this)),(t=o(this,B))==null||t.disconnect(),(e=o(this,k))==null||e.disconnect(),document.removeEventListener("visibilitychange",c(this,n,J).bind(this))},de=function(t){b(this,F,t[0].isIntersecting),o(this,F)?c(this,n,Q).call(this):c(this,n,W).call(this)},J=function(){o(this,F)&&(document.hidden?c(this,n,W).call(this):c(this,n,Q).call(this))},T=function(){o(this,V)&&clearTimeout(o(this,V)),b(this,V,setTimeout(this.resize.bind(this),100))},fe=function(){this.camera.aspect=this.size.width/this.size.height,this.camera.isPerspectiveCamera&&this.cameraFov&&(this.cameraMinAspect&&this.camera.aspect<this.cameraMinAspect?c(this,n,K).call(this,this.cameraMinAspect):this.cameraMaxAspect&&this.camera.aspect>this.cameraMaxAspect?c(this,n,K).call(this,this.cameraMaxAspect):this.camera.fov=this.cameraFov),this.camera.updateProjectionMatrix(),this.updateWorldSize()},K=function(t){const e=Math.tan(q.degToRad(this.cameraFov/2))/(this.camera.aspect/t);this.camera.fov=2*q.radToDeg(Math.atan(e))},pe=function(){var e;this.renderer.setSize(this.size.width,this.size.height),(e=o(this,C))==null||e.setSize(this.size.width,this.size.height);let t=window.devicePixelRatio;this.maxPixelRatio&&t>this.maxPixelRatio?t=this.maxPixelRatio:this.minPixelRatio&&t<this.minPixelRatio&&(t=this.minPixelRatio),this.renderer.setPixelRatio(t),this.size.pixelRatio=t},Q=function(){if(o(this,R))return;const t=()=>{b(this,I,requestAnimationFrame(t)),o(this,P).delta=o(this,O).getDelta(),o(this,P).elapsed+=o(this,P).delta,this.onBeforeRender(o(this,P)),this.render(),this.onAfterRender(o(this,P))};b(this,R,!0),o(this,O).start(),t()},W=function(){o(this,R)&&(cancelAnimationFrame(o(this,I)),b(this,R,!1),o(this,O).stop())},ge=function(){this.renderer.render(this.scene,this.camera)};const S=new Map,L=new $;let j=!1;function Te(s){const t={position:new $,nPosition:new $,hover:!1,onEnter(){},onMove(){},onClick(){},onLeave(){},...s};return function(i,r){S.has(i)||(S.set(i,r),j||(document.body.addEventListener("pointermove",ne),document.body.addEventListener("pointerleave",oe),document.body.addEventListener("click",We),j=!0))}(s.domElement,t),t.dispose=()=>{const e=s.domElement;S.delete(e),S.size===0&&(document.body.removeEventListener("pointermove",ne),document.body.removeEventListener("pointerleave",oe),j=!1)},t}function ne(s){L.x=s.clientX,L.y=s.clientY;for(const[t,e]of S){const i=t.getBoundingClientRect();ye(i)?(ue(e,i),e.hover||(e.hover=!0,e.onEnter(e)),e.onMove(e)):e.hover&&(e.hover=!1,e.onLeave(e))}}function We(s){L.x=s.clientX,L.y=s.clientY;for(const[t,e]of S){const i=t.getBoundingClientRect();ue(e,i),ye(i)&&e.onClick(e)}}function oe(){for(const s of S.values())s.hover&&(s.hover=!1,s.onLeave(s))}function ue(s,t){const{position:e,nPosition:i}=s;e.x=L.x-t.left,e.y=L.y-t.top,i.x=e.x/t.width*2-1,i.y=-e.y/t.height*2+1}function ye(s){const{x:t,y:e}=L,{left:i,top:r,width:p,height:d}=s;return t>=i&&t<=i+p&&e>=r&&e<=r+d}const{randFloat:Ye,randFloatSpread:G}=q,Z=new w,l=new w,h=new w,N=new w,_=new w,D=new w,M=new w,H=new w,re=new w;var Y,ve;class Xe{constructor(t){v(this,Y);this.config=t,this.positionData=new Float32Array(3*t.count).fill(0),this.velocityData=new Float32Array(3*t.count).fill(0),this.sizeData=new Float32Array(t.count).fill(1),this.center=new w,c(this,Y,ve).call(this),this.setSizes()}setSizes(){const{config:t,sizeData:e}=this;e[0]=t.size0;for(let i=1;i<t.count;i++)e[i]=Ye(t.minSize,t.maxSize)}update(t){const{config:e,center:i,positionData:r,sizeData:p,velocityData:d}=this;let y=0;e.controlSphere0&&(y=1,Z.fromArray(r,0),Z.lerp(i,.1).toArray(r,0),h.set(0,0,0).toArray(d,0));for(let m=y;m<e.count;m++){const f=3*m;l.fromArray(r,f),h.fromArray(d,f),h.y-=t.delta*e.gravity*p[m],h.multiplyScalar(e.friction),h.clampLength(0,e.maxVelocity),l.add(h),l.toArray(r,f),h.toArray(d,f)}for(let m=y;m<e.count;m++){const f=3*m;l.fromArray(r,f),h.fromArray(d,f);const a=p[m];for(let x=m+1;x<e.count;x++){const z=3*x;N.fromArray(r,z),_.fromArray(d,z);const X=p[x];D.copy(N).sub(l);const ee=D.length(),te=a+X;if(ee<te){const we=te-ee;M.copy(D).normalize().multiplyScalar(.5*we),H.copy(M).multiplyScalar(Math.max(h.length(),1)),re.copy(M).multiplyScalar(Math.max(_.length(),1)),l.sub(M),h.sub(H),l.toArray(r,f),h.toArray(d,f),N.add(M),_.add(re),N.toArray(r,z),_.toArray(d,z)}}if(e.controlSphere0){D.copy(Z).sub(l);const x=D.length(),z=a+p[0];if(x<z){const X=z-x;M.copy(D.normalize()).multiplyScalar(X),H.copy(M).multiplyScalar(Math.max(h.length(),2)),l.sub(M),h.sub(H)}}Math.abs(l.x)+a>e.maxX&&(l.x=Math.sign(l.x)*(e.maxX-a),h.x=-h.x*e.wallBounce),e.gravity===0?Math.abs(l.y)+a>e.maxY&&(l.y=Math.sign(l.y)*(e.maxY-a),h.y=-h.y*e.wallBounce):l.y-a<-e.maxY&&(l.y=-e.maxY+a,h.y=-h.y*e.wallBounce);const A=Math.max(e.maxZ,e.maxSize);Math.abs(l.z)+a>A&&(l.z=Math.sign(l.z)*(e.maxZ-a),h.z=-h.z*e.wallBounce),l.toArray(r,f),h.toArray(d,f)}}}Y=new WeakSet,ve=function(){const{config:t,positionData:e}=this;this.center.toArray(e,0);for(let i=1;i<t.count;i++){const r=3*i;e[r]=G(2*t.maxX),e[r+1]=G(2*t.maxY),e[r+2]=G(2*t.maxZ)}};class Ue extends Le{constructor(t){super(t),this.uniforms={thicknessDistortion:{value:.1},thicknessAmbient:{value:0},thicknessAttenuation:{value:.1},thicknessPower:{value:2},thicknessScale:{value:10}},this.defines.USE_UV="",this.onBeforeCompile=e=>{Object.assign(e.uniforms,this.uniforms),e.fragmentShader=`
        uniform float thicknessPower;
        uniform float thicknessScale;
        uniform float thicknessDistortion;
        uniform float thicknessAmbient;
        uniform float thicknessAttenuation;
        ${e.fragmentShader}
      `,e.fragmentShader=e.fragmentShader.replace("void main() {",`
        void RE_Direct_Scattering(const in IncidentLight directLight, const in vec2 uv, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, inout ReflectedLight reflectedLight) {
          vec3 scatteringHalf = normalize(directLight.direction + (geometryNormal * thicknessDistortion));
          float scatteringDot = pow(saturate(dot(geometryViewDir, -scatteringHalf)), thicknessPower) * thicknessScale;
          #ifdef USE_COLOR
            vec3 scatteringIllu = (scatteringDot + thicknessAmbient) * vColor;
          #else
            vec3 scatteringIllu = (scatteringDot + thicknessAmbient) * diffuse;
          #endif
          reflectedLight.directDiffuse += scatteringIllu * thicknessAttenuation * directLight.color;
        }

        void main() {
        `);const i=De.lights_fragment_begin.replaceAll("RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );",`
          RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
          RE_Direct_Scattering(directLight, vUv, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, reflectedLight);
        `);e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",i),this.onBeforeCompile2&&this.onBeforeCompile2(e)}}}const je={count:200,colors:[128,0,16777215],ambientColor:16777215,ambientIntensity:.5,lightIntensity:300,materialParams:{metalness:.3,roughness:.4,clearcoat:.8,clearcoatRoughness:.2},minSize:.4,maxSize:.8,size0:1,gravity:1,friction:.99,wallBounce:.95,maxVelocity:.2,maxX:5,maxY:5,maxZ:2,controlSphere0:!1,followCursor:!1},E=new Ee;class Ge extends Fe{constructor(t,e={}){const i={...je,...e},r=new Ae,p=new ke(t,.04).fromScene(r).texture,d=new Be,y=new Ue({envMap:p,...i.materialParams});super(d,y,i.count),this.config=i,this.ambientLight=new Ve(this.config.ambientColor,this.config.ambientIntensity),this.add(this.ambientLight),this.light=new Oe(this.config.colors[0],this.config.lightIntensity),this.light.position.set(0,0,0),this.add(this.light),this.physics=new Xe(i),this.physics&&this.physics.positionData&&this.physics.positionData.length>=3&&this.light.position.fromArray(this.physics.positionData,0),this.setColors(i.colors)}setColors(t){if(Array.isArray(t)&&t.length>1){const e=function(i){let r,p;function d(y){r=y,p=[],r.forEach(m=>{p.push(new se(m))})}return d(i),{setColors:d,getColorAt:function(y,m=new se){const f=Math.max(0,Math.min(1,y))*(r.length-1),a=Math.floor(f),A=p[a];if(a>=r.length-1)return A.clone();const x=f-a,z=p[a+1];return m.r=A.r+x*(z.r-A.r),m.g=A.g+x*(z.g-A.g),m.b=A.b+x*(z.b-A.b),m}}}(t);for(let i=0;i<this.count;i++)this.setColorAt(i,e.getColorAt(i/this.count)),i===0&&this.light.color.copy(e.getColorAt(i/this.count));this.instanceColor.needsUpdate=!0}}update(t){if(this.physics){this.physics.update(t);for(let e=0;e<this.count;e++)E.position.fromArray(this.physics.positionData,3*e),e===0&&this.config.followCursor===!1?E.scale.setScalar(0):E.scale.setScalar(this.physics.sizeData[e]),E.updateMatrix(),this.setMatrixAt(e,E.matrix),e===0&&this.light&&this.light.position.copy(E.position);this.instanceMatrix.needsUpdate=!0}}}function Ze(s,t={}){const e=new He({canvas:s,size:"parent",rendererOptions:{antialias:!0,alpha:!0}});let i;e.renderer.toneMapping=Ie,e.camera.position.set(0,0,20),e.camera.lookAt(0,0,0),e.cameraMaxAspect=1.5,e.resize(),f(t);const r=new Ne,p=new _e(new w(0,0,1),0),d=new w;let y=!1;const m=Te({domElement:s,onMove(){r.setFromCamera(m.nPosition,e.camera),e.camera.getWorldDirection(p.normal),r.ray.intersectPlane(p,d),i.physics.center.copy(d),i.config.controlSphere0=!0},onLeave(){i.config.controlSphere0=!1}});function f(a){i&&(e.clear(),e.scene.remove(i)),i=new Ge(e.renderer,a),e.scene.add(i)}return e.onBeforeRender=a=>{y||i.update(a)},e.onAfterResize=a=>{i.config.maxX=a.wWidth/2,i.config.maxY=a.wHeight/2},{three:e,get spheres(){return i},setCount(a){f({...i.config,count:a})},togglePause(){y=!y},dispose(){m.dispose(),e.dispose()}}}class qe{constructor(t,e={}){this.instance=Ze(t,e)}setCount(t){this.instance.setCount(t)}togglePause(){this.instance.togglePause()}dispose(){this.instance.dispose()}}document.addEventListener("DOMContentLoaded",()=>{const s=document.getElementById("ballpit-canvas");if(!s)return;const t=new qe(s,{count:200,colors:[16711680,65280,255,16776960,16711935,65535],gravity:.7,friction:.8,wallBounce:.95,followCursor:!0});window.addEventListener("resize",()=>{t&&t.instance&&t.instance.three&&t.instance.three.resize()})});
